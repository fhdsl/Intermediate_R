# Data Cleaning, Part 2 Exercises

## Part 1: Tidying data warm-up

```{r}
library(tidyverse)
billboard_sm = select(billboard, artist, track, date.entered, wk1, wk2, wk3, wk4)
```

Consider the `billboard_sm` dataframe: Each observation is a song track, and each observation has its own row. The variables "artist", "track", and "date.entered" all seem like very reasonable variables that are columns. However, "wk1", "wk2", "wk3", and "wk4" seem to be values of a variable "week".

Using `pivot_longer`, take "wk1", "wk2", "wk3", and "wk4" columns to be values of the column "week" and have "billboard_ranking" to be the column name of the resulting values. In the process, you will need to specify the following arguments after you specify the dataframe in `pivot_longer()`: `cols`, `names_to`, and `values_to`. Store the result as `billboard_long`.

```{r}

```

We can visualize this:

```{r}
#uncomment code below

#ggplot(your_df_here) + aes(x = week, y = billboard_rank, group = track) + geom_line(alpha = .25)
```

Can you undo the process via `pivot_wider()`? You will need to state the function arguments `names_from`, and `values_from` after specifying the dataframe. The resulting dataframe should look identical as `billboard_sm`.

```{r}

```

## Part x: Tidying data in State Cancer Profiles

We continue our data analysis of State Cancer Profiles. We want to examine cancer incidence rates in state of Washington and make some comparisons between groups: specifically, we want to see whether there is a difference of melanoma (skin) cancer incidence between females and males for each county in Washington state.

In our last exercise, we loaded in data for females melanoma cancer for each county in Washington state, and did some data cleaning. Let's show that process again, and repeat it for males:

```{r}
#install.packages("pak")
#library(pak)
#pak("getwilds/cancerprof@practice")
#library(cancerprof)
```

```{r}
#female
female_melanoma_WA = incidence_cancer("WA", "county", "melanoma of the skin", "all races (includes hispanic)", "females", "all ages", "all stages", "latest 5 year average")
female_melanoma_WA = select(female_melanoma_WA, County, `Age Adjusted Incidence Rate`)
names(female_melanoma_WA) = c("County", "Age_adjusted_incidence_rate")
female_melanoma_WA$Age_adjusted_incidence_rate[female_melanoma_WA$Age_adjusted_incidence_rate == "* "] = NA
female_melanoma_WA$Age_adjusted_incidence_rate = as.numeric(female_melanoma_WA$Age_adjusted_incidence_rate)

#male
male_melanoma_WA = incidence_cancer("WA", "county", "melanoma of the skin", "all races (includes hispanic)", "males", "all ages", "all stages", "latest 5 year average")
male_melanoma_WA = select(male_melanoma_WA, County, `Age Adjusted Incidence Rate`)
names(male_melanoma_WA) = c("County", "Age_adjusted_incidence_rate")
male_melanoma_WA$Age_adjusted_incidence_rate[male_melanoma_WA$Age_adjusted_incidence_rate == "* "] = NA
male_melanoma_WA$Age_adjusted_incidence_rate = as.numeric(male_melanoma_WA$Age_adjusted_incidence_rate)
```

If we look at both dataframes, they seem to both be in a great Tidy state.

To compare the incidence rate between the two groups, we need them to be in the same dataframe. Let's join them with a common column `County`.

```{r}
male_vs_female = full_join(male_melanoma_WA, female_melanoma_WA, by = "County", suffix = c(".male", ".female"))
```

Let's look at this `male_vs_female` dataframe carefully.

Each observation is a county, and each observation has its own row. Looks good.

How about variables? Are they in their own columns? This gets a little bit fuzzy, because we could interpret the male and female cancer incidence rate ("Age_adjusted_incidence_rate.male", Age_adjusted_incidence_rate.female") as variables, or we could interpret them as values of a variable "sex".

Ultimately, this depends on the analysis we want to do: we would like to have a grouped barchart figure in which the x-axis is the county name, the y-axis is the incidence rate, and each bar to have a component for each sex. In ggplot, that means we need a variable (column) of county, incidence rate, and sex. See this sketch below.

Therefore, we should prefer the latter interpretation: "Age_adjusted_incidence_rate.male" "Age_adjusted_incidence_rate.female" should be values for the variable "sex". We eventually need to recode these two values as "male" and "female", respectively.

Your turn: use `pivot_longer()` on `male_vs_female` dataframe, to take "Age_adjusted_incidence_rate.male" "Age_adjusted_incidence_rate.female" columns to be values of the column "sex", and have `values_to` argument be "Age_adjusted_incidence_rate".

```{r}

```

Then, recode the values of the "sex" column from "Age_adjusted_incidence_rate.female" to "female", and "Age_adjusted_incidence_rate.male" to "male".

```{r}

```

There are some `NA`s in the column "Age_adjusted_incidence_rate". Can you filter these rows out of `male_vs_female`?

```{r}

```

Let's make the plot! I'll get you started...

```{r}
#uncomment code below

#ggplot(your_df_here, aes(x = County, y = Age_adjusted_incidence_rate, fill = sex)) + geom_bar(position="dodge", stat="identity") + theme(axis.text.x = element_text(angle = 90)) + labs(title = "Melanoma", y = "Incidence Rate per 100k people")
```
